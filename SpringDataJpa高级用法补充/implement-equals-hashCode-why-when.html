
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>implement-equals,-hashCode-why,when? · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="JPA中lazy-loading-doesn’t-work.html" />
    
    
    <link rel="prev" href="SpringDataJPA之Hibernate加载过程.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    《Spring Data JPA实战》
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../《SpringDataJpa实战》书/01.html">
            
                <a href="../《SpringDataJpa实战》书/01.html">
            
                    
                    01：整体认识JPA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../《SpringDataJpa实战》书/02.html">
            
                <a href="../《SpringDataJpa实战》书/02.html">
            
                    
                    02：Jpa基础查询方法JpaRepository详解        
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../《SpringDataJpa实战》书/03.html">
            
                <a href="../《SpringDataJpa实战》书/03.html">
            
                    
                    03：定义查询方法(Defining Query Methods    
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../《SpringDataJpa实战》书/04.html">
            
                <a href="../《SpringDataJpa实战》书/04.html">
            
                    
                    04：注解式查询方法    
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../《SpringDataJpa实战》书/05.html">
            
                <a href="../《SpringDataJpa实战》书/05.html">
            
                    
                    05：@Entity实例里面常用注解详解            
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../《SpringDataJpa实战》书/06.html">
            
                <a href="../《SpringDataJpa实战》书/06.html">
            
                    
                    06：JpaRepository扩展之QueryByExampleExecutor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../《SpringDataJpa实战》书/07.html">
            
                <a href="../《SpringDataJpa实战》书/07.html">
            
                    
                    07：JpaRepository扩展之JpaSpecificationExecutor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../《SpringDataJpa实战》书/08.html">
            
                <a href="../《SpringDataJpa实战》书/08.html">
            
                    
                    08 :  JpaRepository扩展之自定义Repositor    
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../《SpringDataJpa实战》书/09.html">
            
                <a href="../《SpringDataJpa实战》书/09.html">
            
                    
                    09：Auditing与@version                    
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../《SpringDataJpa实战》书/10.html">
            
                <a href="../《SpringDataJpa实战》书/10.html">
            
                    
                    10：对MvcWeb的支持分页和排序的支持            
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="../《SpringDataJpa实战》书/11.html">
            
                <a href="../《SpringDataJpa实战》书/11.html">
            
                    
                    11：Spring Data Jpa的配置之SpringBoot2.0加载详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="../《SpringDataJpa实战》书/12.html">
            
                <a href="../《SpringDataJpa实战》书/12.html">
            
                    
                    12：DataSource的配置与事务详解、多数据源        
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.13" data-path="../《SpringDataJpa实战》书/13.html">
            
                <a href="../《SpringDataJpa实战》书/13.html">
            
                    
                    13：Spring Data Jpa之QueryDSL支持    
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Spring DATA JPA 扩展阅读
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="SpringDataJPA的一些高级用法扩展.html">
            
                <a href="SpringDataJPA的一些高级用法扩展.html">
            
                    
                    Spring Data JPA 晋级提升篇：复杂场景实战用法与优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="SpringDataJPA之Hibernate加载过程.html">
            
                <a href="SpringDataJPA之Hibernate加载过程.html">
            
                    
                    SpringDataJPA之Hibernate加载过程
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.3" data-path="implement-equals-hashCode-why-when.html">
            
                <a href="implement-equals-hashCode-why-when.html">
            
                    
                    implement-equals,-hashCode-why,when?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="JPA中lazy-loading-doesn’t-work.html">
            
                <a href="JPA中lazy-loading-doesn’t-work.html">
            
                    
                    JPA中lazy-loading-doesn’t-work
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="SpringDataJPA之Entity关联关系Lazy过程.html">
            
                <a href="SpringDataJPA之Entity关联关系Lazy过程.html">
            
                    
                    SpringDataJPA之Entity关联关系Lazy过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="SpringDataJpa之Hibernate5.0的Entity判断Dirty的过程.html">
            
                <a href="SpringDataJpa之Hibernate5.0的Entity判断Dirty的过程.html">
            
                    
                    SpringDataJpa之Hibernate5.0的Entity判断Dirty的过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="多线程环境下遇到的Session的更新的坑，CompletableFuture使用的坑.html">
            
                <a href="多线程环境下遇到的Session的更新的坑，CompletableFuture使用的坑.html">
            
                    
                    多线程环境下遇到的Session的更新的坑，CompletableFuture使用的坑
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >implement-equals,-hashCode-why,when?</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h4 id="1-&#x9996;&#x5148;&#x6211;&#x4EEC;&#x8981;&#x9AD8;&#x660E;&#x767D;&#xFF0C;equals&#x548C;hashcode&#x7684;&#x4F5C;&#x7528;&#xFF1A;">1. &#x9996;&#x5148;&#x6211;&#x4EEC;&#x8981;&#x9AD8;&#x660E;&#x767D;&#xFF0C;equals&#x548C;hashCode&#x7684;&#x4F5C;&#x7528;&#xFF1A;</h4>
<p><code>&#x53C2;&#x8003;&#xFF1A;[https://www.journaldev.com/21095/java-equals-hashcode](https://www.journaldev.com/21095/java-equals-hashcode)</code>
<img src="https://github.com/zhangzhenhuajack/spring-data-jpa-guide/tree/master/images/equals/1.png" alt=""></p>
<pre><code>&#x6211;&#x4EEC;&#x8981;&#x660E;&#x767D;&#x51E0;&#x70B9;&#xFF1A;
1. equals&#x548C;hashcode&#x8981;&#x540C;&#x65F6;&#x5B9E;&#x73B0;&#xFF1B;
2. &#x9ED8;&#x8BA4;object&#x7C7B;&#x91CC;&#x9762;&#x7684;&#x662F;&#x5F15;&#x7528;&#x5730;&#x5740;&#x6BD4;&#x8F83;&#xFF1B;
</code></pre><pre><code>public boolean equals(Object obj) {
    return (this == obj);
}
</code></pre><pre><code>````
![](https://github.com/zhangzhenhuajack/spring-data-jpa-guide/tree/master/images/equals/eclipse-generate-hashcode-equals.png)
&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;&#x5B9E;&#x73B0;&#xFF1B;

##### 2. hibernatre&#x91CC;&#x9762;&#x6211;&#x4EEC;&#x5982;&#x4F55;&#x53BB;&#x5B9E;&#x73B0;equals&#x548C;hashCode;
</code></pre><p>&#x53C2;&#x8003;&#xFF1A;
<a href="https://vladmihalcea.com/the-best-way-to-implement-equals-hashcode-and-tostring-with-jpa-and-hibernate/" target="_blank">https://vladmihalcea.com/the-best-way-to-implement-equals-hashcode-and-tostring-with-jpa-and-hibernate/</a>
<a href="https://vladmihalcea.com/how-to-implement-equals-and-hashcode-using-the-jpa-entity-identifier/" target="_blank">https://vladmihalcea.com/how-to-implement-equals-and-hashcode-using-the-jpa-entity-identifier/</a></p>
<pre><code>##### Fixing the entity identifier equals and hashCode
To address the previous issue, there is only one solution: the hashCode should always return the same value:
</code></pre><p>@Entity
public class Book implements Identifiable<long> {</long></p>
<pre><code>@Id
@GeneratedValue
private Long id;

private String title;

@Override
public boolean equals(Object o) {
    if (this == o) return true;

    if (!(o instanceof Book))
        return false;

    Book other = (Book) o;

    return id != null &amp;&amp;
           id.equals(other.getId());
}

@Override
public int hashCode() {
    return 31;
}

//Getters and setters omitted for brevity
</code></pre><p>}</p>
<pre><code>Also, when the entity identifier is null, we can guarantee equality only for the same object references. Otherwise, no transient object is equal to any other transient or persisted object. That&#x2019;s why the identifier equality check is done only if the current Object identifier is not null.

With this implementation, the equals and hashCode test runs fine for all entity state transitions. The reason why it works is that the hashCode value does not change, hence, we can rely on the java.lang.Object reference equality as long as the identifier is null.

###### Natural id
The first use case to test is the natural id mapping. Considering the following entity:
</code></pre><p>@Entity
public class Book implements Identifiable<long> {</long></p>
<pre><code>@Id
@GeneratedValue
private Long id;

private String title;

@NaturalId
private String isbn;

@Override
public boolean equals(Object o) {
    if (this == o) return true;
    if (!(o instanceof Book)) return false;
    Book book = (Book) o;
    return Objects.equals(getIsbn(), book.getIsbn());
}

@Override
public int hashCode() {
    return Objects.hash(getIsbn());
}

//Getters and setters omitted for brevity
</code></pre><p>}
````
The isbn property is also a @NaturalId, therefore, it should be unique and not nullable. Both equals and hashCode use the isbn property in their implementations.</p>
<h5 id="3-&#x5E94;&#x7528;&#x573A;&#x666F;">3. &#x5E94;&#x7528;&#x573A;&#x666F;</h5>
<ol>
<li>&#x671F;&#x5F85;&#x8DE8;session&#x5171;&#x4EAB;entity&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5E76;&#x4E14;&#x662F;&#x7528;set&#x6216;&#x8005;&#x7C7B;&#x4F3C;hashTable&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x671F;&#x5F85;&#x4E1A;&#x52A1;&#x5BF9;&#x8C61;&#x91CD;&#x590D;&#xFF0C;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x3002;</li>
<li>&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x4E2A;&#x4EBA;&#x4E0D;&#x5EFA;&#x8BAE;&#x53BB;&#x5B9E;&#x73B0;&#x8FD9;&#x4E24;&#x4E2A;&#xFF0C;&#x4E0D;&#x8FC7;&#x4E5F;&#x6709;&#x4EBA;&#x8BF4;&#x6700;&#x597D;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x662F;&#x4E2A;&#x4EBA;&#x89C2;&#x70B9;&#x5F53;&#x7528;&#x5230;&#x8FD9;&#x4E2A;&#x573A;&#x666F;&#x518D;&#x8BF4;&#xFF0C;&#x6CA1;&#x5FC5;&#x8981;&#x4E00;&#x5B9A;&#x8981;&#x53BB;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x4E2A;&#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x4E00;&#x8D77;&#x8BA8;&#x8BBA;</li>
</ol>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="SpringDataJPA之Hibernate加载过程.html" class="navigation navigation-prev " aria-label="Previous page: SpringDataJPA之Hibernate加载过程">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="JPA中lazy-loading-doesn’t-work.html" class="navigation navigation-next " aria-label="Next page: JPA中lazy-loading-doesn’t-work">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"implement-equals,-hashCode-why,when?","level":"1.3.3","depth":2,"next":{"title":"JPA中lazy-loading-doesn’t-work","level":"1.3.4","depth":2,"path":"SpringDataJpa高级用法补充/JPA中lazy-loading-doesn’t-work.md","ref":"./SpringDataJpa高级用法补充/JPA中lazy-loading-doesn’t-work.md","articles":[]},"previous":{"title":"SpringDataJPA之Hibernate加载过程","level":"1.3.2","depth":2,"path":"SpringDataJpa高级用法补充/SpringDataJPA之Hibernate加载过程.md","ref":"./SpringDataJpa高级用法补充/SpringDataJPA之Hibernate加载过程.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"SpringDataJpa高级用法补充/implement-equals-hashCode-why-when.md","mtime":"2019-12-17T06:00:37.559Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-12-17T06:04:38.403Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

